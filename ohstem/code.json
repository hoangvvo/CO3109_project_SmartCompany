{"mode":"block","xmlText":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"(F^M+-KsQ)/#n$q9m?PL\">data</variable><variable id=\"0S!o4lsO0UOxc?2`ou/C\">path</variable><variable id=\"EP[6LF+ygQ06GpQ[$/#,\">state</variable><variable id=\"BhA}X6]X_f4B4sMu]S.M\">value</variable></variables><block type=\"yolobit_basic_forever\" id=\"w5Bl*-!,Ihc8X2tI)wP*\" x=\"62\" y=\"113\"><statement name=\"ONSTART\"><block type=\"yolobit_mqtt_connect_wifi\" id=\"if@LuvywSPwbk(yKpw;b\"><value name=\"WIFI\"><shadow type=\"text\" id=\"g$][K;TVcrcg;SQK,QWa\"><field name=\"TEXT\">CE-lab</field></shadow></value><value name=\"PASSWORD\"><shadow type=\"text\" id=\"*c7,v#,[$wF.7YB==h%r\"><field name=\"TEXT\">netfpga1</field></shadow></value><next><block type=\"yolobit_mqtt_connect_default_servers\" id=\"u{IW*ooD4tWe1y;:$vJ}\"><field name=\"SERVER\">mqtt.ohstem.vn</field><value name=\"USERNAME\"><shadow type=\"text\" id=\"y;EbZ1o5|!2b([6#.0y{\"><field name=\"TEXT\">yolobit123</field></shadow></value><value name=\"KEY\"><shadow type=\"text\" id=\"=)Sq`#_0z8_BCFi7SEOH\"><field name=\"TEXT\"></field></shadow></value><next><block type=\"yolobit_mqtt_on_receive_message\" id=\"Qf6163r/9sR,/=,Q|=z4\"><field name=\"message\" id=\"(F^M+-KsQ)/#n$q9m?PL\">data</field><value name=\"TOPIC\"><shadow type=\"text\" id=\"q[S6~JqgNNsns9;)_3!d\"><field name=\"TEXT\">device_state_set</field></shadow></value><statement name=\"ACTION\"><block type=\"variables_set\" id=\"Fz_*9}=Ds?r;KiLDKz2J\"><field name=\"VAR\" id=\"0S!o4lsO0UOxc?2`ou/C\">path</field><value name=\"VALUE\"><block type=\"yolobit_json_index\" id=\"dp+Y2!$.3tUCbnYU1Z9s\"><value name=\"FIND\"><shadow type=\"text\" id=\"emxnfjU=RVB}saTbEGi6\"><field name=\"TEXT\">path</field></shadow></value><value name=\"INPUT\"><shadow type=\"text\" id=\"Q/=J%JzV0kfLI,aJ)N5K\"><field name=\"TEXT\">data</field></shadow><block type=\"variables_get\" id=\"T0}lQujS{([(4!%Tf59f\"><field name=\"VAR\" id=\"(F^M+-KsQ)/#n$q9m?PL\">data</field></block></value></block></value><next><block type=\"variables_set\" id=\"{[k0lBAqaN{SVk;GlSk1\"><field name=\"VAR\" id=\"EP[6LF+ygQ06GpQ[$/#,\">state</field><value name=\"VALUE\"><block type=\"yolobit_json_index\" id=\"B8{?Q5tUa@lb(}{G2S48\"><value name=\"FIND\"><shadow type=\"text\" id=\",]b3k1UNZpa?~sfUrK=#\"><field name=\"TEXT\">state</field></shadow></value><value name=\"INPUT\"><shadow type=\"text\" id=\"*qMUG9#jJU/}haD^?iZK\"><field name=\"TEXT\">{\"key\":\"value\"}</field></shadow><block type=\"variables_get\" id=\"{*aGI:g=ya+^mx%k5`lk\"><field name=\"VAR\" id=\"(F^M+-KsQ)/#n$q9m?PL\">data</field></block></value></block></value><next><block type=\"variables_set\" id=\"wf%H)Ev$wKpbcZ3Q!;r#\"><field name=\"VAR\" id=\"BhA}X6]X_f4B4sMu]S.M\">value</field><value name=\"VALUE\"><block type=\"yolobit_json_index\" id=\"sB[lqi*w3JIgnWa|D3#Q\"><value name=\"FIND\"><shadow type=\"text\" id=\"Ob~H^q+@McX0|FNp%`A4\"><field name=\"TEXT\">value</field></shadow></value><value name=\"INPUT\"><shadow type=\"text\" id=\"[pEPQUU!3P:+w]WoKa6F\"><field name=\"TEXT\">{\"key\":\"value\"}</field></shadow><block type=\"variables_get\" id=\"IScDPv.:{=onMv^Q)]2*\"><field name=\"VAR\" id=\"(F^M+-KsQ)/#n$q9m?PL\">data</field></block></value></block></value><next><block type=\"controls_if\" id=\"/Wu+9^UC}Chj]H]ZGGq%\"><value name=\"IF0\"><block type=\"logic_compare\" id=\"0NW=Ri2`k9,Ckm79)rgS\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"|i`nE/g0y(/BpoF3?p%X\"><field name=\"VAR\" id=\"0S!o4lsO0UOxc?2`ou/C\">path</field></block></value><value name=\"B\"><block type=\"text\" id=\"KO#qUx`NzBANTm*[Lqyz\"><field name=\"TEXT\">P1</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\" id=\"Omz]OKp3{5C/D0Bh|w1t\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_compare\" id=\":#.Pma3aM@OO_sz;{j$i\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"jXJdt4D`cp.`#K^+N69]\"><field name=\"VAR\" id=\"EP[6LF+ygQ06GpQ[$/#,\">state</field></block></value><value name=\"B\"><block type=\"text\" id=\"~@5qtv(9dQ9khdE/V0Sd\"><field name=\"TEXT\">on</field></block></value></block></value><statement name=\"DO0\"><block type=\"aiot_led_tiny_set_all\" id=\"UU@2Z8RL2m3^TH(2@WJ|\"><field name=\"port\">pin1</field><field name=\"option\">0</field><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"{yBVx-0MYS}-RGY6jiF@\"><field name=\"COLOUR\">#ff0000</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"aiot_led_tiny_set_all\" id=\"CT9.6kLfAH7^t-).4e;(\"><field name=\"port\">pin1</field><field name=\"option\">0</field><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"`nzGswzf|Z;5M?0=,[oE\"><field name=\"COLOUR\">#000000</field></shadow></value></block></statement></block></statement><next><block type=\"controls_if\" id=\"f8:CoF/omyse8@X:#xR/\"><value name=\"IF0\"><block type=\"logic_compare\" id=\",:IDIqOJd76)3wApcFVN\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"A07*[)p/*B}JWF{@351i\"><field name=\"VAR\" id=\"0S!o4lsO0UOxc?2`ou/C\">path</field></block></value><value name=\"B\"><block type=\"text\" id=\"uDS@[BxLFJV,.)vs.9v(\"><field name=\"TEXT\">P2</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\" id=\"lN54xuRSDUi$+a1,gMDb\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_compare\" id=\"9^PFNk*zaR0;S6/k(-3=\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"K,@tM.wTJYO#Z(.i_i2}\"><field name=\"VAR\" id=\"EP[6LF+ygQ06GpQ[$/#,\">state</field></block></value><value name=\"B\"><block type=\"text\" id=\":Ukc6tL{aC+:$LwvNYZ~\"><field name=\"TEXT\">on</field></block></value></block></value><statement name=\"DO0\"><block type=\"aiot_minifan\" id=\"v.pO5E-Y6J=%gPJ#YcMk\"><field name=\"NAME\">pin10</field><value name=\"percent\"><shadow type=\"math_number\" id=\"]},o{):M7nhEPj7Gb=?e\"><field name=\"NUM\">70</field></shadow><block type=\"variables_get\" id=\"b:mtA{g5+[rBay_/y$D|\"><field name=\"VAR\" id=\"BhA}X6]X_f4B4sMu]S.M\">value</field></block></value></block></statement><statement name=\"ELSE\"><block type=\"aiot_minifan\" id=\"$Q3OJeQL-mJ,.-$z8GA%\"><field name=\"NAME\">pin10</field><value name=\"percent\"><shadow type=\"math_number\" id=\"]},o{):M7nhEPj7Gb=?e\"><field name=\"NUM\">0</field></shadow></value></block></statement></block></statement></block></next></block></next></block></next></block></next></block></statement></block></next></block></next></block></statement><statement name=\"FOREVER\"><block type=\"yolobit_mqtt_check_message\" id=\"Iw.|PJHYI*h!e0hwqEk%\"><next><block type=\"yolobit_events_run\" id=\"*a9yw/n}LV4!m%eEoq2(\"><next><block type=\"yolobit_basic_sleep\" id=\"`5tI`8zFFgDh9L~.Cpzq\"><value name=\"duration\"><shadow type=\"math_number\" id=\"~i~.G-aex@++a8q=M2l+\"><field name=\"NUM\">1000</field></shadow></value></block></next></block></next></block></statement></block><block type=\"yolobit_events_timer\" id=\"Q)rgk3a(8fG^)0J}TnGS\" x=\"338\" y=\"787\"><value name=\"INTERVAL\"><shadow type=\"math_number\" id=\"6lwr32WUPtSB81@Nr8M^\"><field name=\"NUM\">30</field></shadow></value><statement name=\"ACTION\"><block type=\"yolobit_mqtt_publish\" id=\"HPmO#^]m+xD_1t_oMxxj\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\";qa*Me/3iN4k#}24*SDD\"><field name=\"TEXT\">Hello</field></shadow><block type=\"yolobit_json_object\" id=\")cTXWnmA[tOukOo.NW1o\"><statement name=\"MEMBERS\"><block type=\"yolobit_json_member\" id=\"E(U}.Ssl?0tKlMbDLC|I\"><field name=\"MEMBER_NAME\">state</field><value name=\"MEMBER_VALUE\"><shadow type=\"text\" id=\"VK`E`u@K)mJKXz*Sx(1-\"><field name=\"TEXT\">on</field></shadow></value><next><block type=\"yolobit_json_member\" id=\"_)f3JT)CHkrZHgdL,wu{\"><field name=\"MEMBER_NAME\">extra_data</field><value name=\"MEMBER_VALUE\"><shadow type=\"text\" id=\"LH4CayoFQo=}B9q0xP^G\"><field name=\"TEXT\"></field></shadow><block type=\"yolobit_json_object\" id=\"ER6-Ot5Q-?Z}*+/!j?i?\"><statement name=\"MEMBERS\"><block type=\"yolobit_json_member\" id=\"5OCzVY]v8l|-LyYKpO.e\"><field name=\"MEMBER_NAME\">temperature</field><value name=\"MEMBER_VALUE\"><shadow type=\"text\" id=\"ed~)V%Vv$O5@1JU_.M[-\"><field name=\"TEXT\"></field></shadow><block type=\"aiot_dht_read\" id=\"wrmeyC(Um8y+dt#f7wz`\"><field name=\"DATA\">TEMP</field></block></value><next><block type=\"yolobit_json_member\" id=\"_Y-s]3?vd^7bt`Zj|U:d\"><field name=\"MEMBER_NAME\">humidity</field><value name=\"MEMBER_VALUE\"><shadow type=\"text\" id=\"ed~)V%Vv$O5@1JU_.M[-\"><field name=\"TEXT\"></field></shadow><block type=\"aiot_dht_read\" id=\"m6_g*ti$DMt~SvD]jKgw\"><field name=\"DATA\">HUMID</field></block></value></block></next></block></statement></block></value></block></next></block></statement></block></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"`JOUC_.k|c:V$sa{()T`\"><field name=\"TEXT\">device_state_changed</field></shadow></value></block></statement></block></xml>","python":"from mqtt import *\nimport ujson\nfrom yolobit import *\nbutton_a.on_pressed = None\nbutton_b.on_pressed = None\nbutton_a.on_pressed_ab = button_b.on_pressed_ab = -1\nfrom aiot_rgbled import RGBLed\nfrom event_manager import *\nimport time\nfrom machine import Pin, SoftI2C\nfrom aiot_dht20 import DHT20\n\ntiny_rgb = RGBLed(pin1.pin, 4)\n\ndef on_mqtt_message_receive_callback__device_state_set_(data):\n  global path, state, value\n  path = ujson.loads(data)['path']\n  state = ujson.loads(data)['state']\n  value = ujson.loads(data)['value']\n  if path == 'P1':\n    if state == 'on':\n      tiny_rgb.show(0, hex_to_rgb('#ff0000'))\n    else:\n      tiny_rgb.show(0, hex_to_rgb('#000000'))\n  if path == 'P2':\n    if state == 'on':\n      pin10.write_analog(round(translate(value, 0, 100, 0, 1023)))\n    else:\n      pin10.write_analog(round(translate(0, 0, 100, 0, 1023)))\n\nevent_manager.reset()\n\naiot_dht20 = DHT20(SoftI2C(scl=Pin(22), sda=Pin(21)))\n\ndef on_event_timer_callback_Q_r_g_k_a():\n  global data, path, state, value\n  mqtt.publish('device_state_changed', ({\n    \"state\" : 'on',\n    \"extra_data\" : ({\n      \"temperature\" : (aiot_dht20.dht20_temperature()),\n      \"humidity\" : (aiot_dht20.dht20_humidity())\n    })\n  }))\n\nevent_manager.add_timer_event(30000, on_event_timer_callback_Q_r_g_k_a)\n\nif True:\n  mqtt.connect_wifi('CE-lab', 'netfpga1')\n  mqtt.connect_broker(server='mqtt.ohstem.vn', port=1883, username='yolobit123', password='')\n  mqtt.on_receive_message('device_state_set', on_mqtt_message_receive_callback__device_state_set_)\n\nwhile True:\n  mqtt.check_message()\n  event_manager.run()\n  time.sleep_ms(1000)\n","name":"dadn","extensions":[{"id":"yolobit-AITT-VN-yolobit_extension_events","src":"https://github.com/AITT-VN/yolobit_extension_events","name":"SỰ KIỆN","description":"Mục mở rộng hỗ trợ sử dụng sự kiện trong chương trình"},{"id":"yolobit-AITT-VN-yolobit_extension_events","src":"https://github.com/AITT-VN/yolobit_extension_events","name":"SỰ KIỆN","description":"Mục mở rộng hỗ trợ sử dụng sự kiện trong chương trình"},{"id":"yolobit-AITT-VN-yolobit_extension_https","src":"https://github.com/AITT-VN/yolobit_extension_https","name":"HTTP","description":"Mục mở rộng hỗ trợ giao tiếp HTTP cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_https","src":"https://github.com/AITT-VN/yolobit_extension_https","name":"HTTP","description":"Mục mở rộng hỗ trợ giao tiếp HTTP cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_https","src":"https://github.com/AITT-VN/yolobit_extension_https","name":"HTTP","description":"Mục mở rộng hỗ trợ giao tiếp HTTP cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_aiot","src":"https://github.com/AITT-VN/yolobit_extension_aiot","name":"AIOT Kit","description":"Mục mở rộng dành cho bộ kit AIoT"},{"id":"yolobit-AITT-VN-yolobit_extension_aiot","src":"https://github.com/AITT-VN/yolobit_extension_aiot","name":"AIOT Kit","description":"Mục mở rộng dành cho bộ kit AIoT"},{"id":"yolobit-AITT-VN-yolobit_extension_aiot","src":"https://github.com/AITT-VN/yolobit_extension_aiot","name":"AIOT Kit","description":"Mục mở rộng dành cho bộ kit AIoT"}],"device":"yolobit"}